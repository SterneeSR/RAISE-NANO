{% extends "users/dashboard.html" %}
{% load static %}

{% block dashboard_content %}
<h1 class="page-header">Your Favorites</h1>

<div class="cards-container">
    {% for p in products %}
        <div class="product-card">
            <div class="prod-icons">
                {% if p.buy_option == 'internal' %}
                <a 
                    href="{% url 'cart:add_to_cart' p.id %}"
                    class="prod-btn cart" 
                    title="Add to Cart" 
                    aria-label="Add {{ p.name }} to Cart">
                    <i class="fa fa-shopping-cart"></i>
                </a>
                {% endif %}
                
                <button 
                    class="prod-btn like {% if p.id in favorited_ids %}active{% endif %}" 
                    title="Add to Favorites" 
                    aria-label="Add {{ p.name }} to Favorites" 
                    data-product-id="{{ p.id }}"
                    data-fav-url="{% url 'favorites:toggle_favorite' p.id %}">
                    <i class="fa fa-heart" {% if p.id in favorited_ids %}style="color:red;"{% endif %}></i>
                </button>
            </div>
            <div class="prod-img">
                {% if p.image %}
                    <img src="{{ p.image.url }}" alt="{{ p.name }}">
                {% else %}
                    <img src="{% static 'products/img.png' %}" alt="{{ p.name }}">
                {% endif %}
            </div>
            <div class="prod-details">
                <span class="prod-tag">{{ p.startup.name|default:"RCN Startup" }}</span>
                <h3 class="prod-name">{{ p.name }}</h3>
                {% if p.price %}
                <div class="prod-price">
                    ₹{{ p.price }}
                    {% if p.old_price %}
                        <span class="old-price">₹{{ p.old_price }}</span>
                    {% endif %}
                </div>
                {% else %}
                <div class="prod-price">Contact for price</div>
                {% endif %}
            </div>
            {% if p.buy_option == 'external' and p.external_url %}
                <a class="buy-now-btn" href="{{ p.external_url }}" target="_blank" rel="noopener">Buy on Startup Site</a>
            {% else %}
                <a class="buy-now-btn" href="{% url 'products:product_detail' p.slug %}">View Details</a>
            {% endif %}
        </div>
    {% empty %}
        <div class="card" style="text-align: center; grid-column: 1 / -1;">
            <p>You haven't favorited any items yet.</p>
        </div>
    {% endfor %}
</div>
{% endblock %}